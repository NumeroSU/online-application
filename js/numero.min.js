function onLogin(){_user=$("#github_user").prop("value");_pwd=$("#github_pwd").prop("value");auth=btoa(_user+":"+_pwd);document.cookie="username="+_user;document.cookie="password="+_pwd;$.get({url:"https://api.github.com/users/"+_user+"/repos",headers:{Authorization:"Basic "+auth},success:getRepos})}function getRepos(b){$("#github_repositories").prop("disabled",!1);for(i=0;i<b.length;i++)$("#github_repositories").append("<option>"+b[i].name+"</option>");repo=b[0].name;getFiles(b[0].name)}
function getFiles(b){$.get({url:"https://api.github.com/repos/"+_user+"/"+b+"/contents",headers:{Authorization:"Basic "+auth},success:function(a){$("#github_files").prop("disabled",!1);for(i=0;i<a.length;i++)$("#github_files").append("<option>"+a[i].name+"</option>");file=a[0].name;getFileVersions(file)}})}
function getFileVersions(b){$.get({url:"https://api.github.com/repos/"+_user+"/"+repo+"/commits?path="+b,headers:{Authorization:"Basic "+auth},success:function(a){$("#button_load").prop("disabled",!1);$("#github_version").prop("disabled",!1);for(i=0;i<a.length;i++)$("#github_version").append("<option sha='"+a[i].commit.tree.sha+"'>"+a[i].commit.author.name+" - "+a[i].commit.message+"</option>");sha=a[0].commit.tree.sha;console.log(sha);getFileContent(file,sha)}})}
function getFileContent(b,a){$.get({url:"https://api.github.com/repos/"+_user+"/"+repo+"/git/trees/"+a,headers:{Authorization:"Basic "+auth},success:function(a){for(i=0;i<a.tree.length;i++)if(a.tree[i].path==b){var c=a.tree[i].sha;_file_sha=c;$.get({url:"https://api.github.com/repos/"+_user+"/"+repo+"/git/blobs/"+c,headers:{Authorization:"Basic "+auth},success:function(a){content=atob(a.content);$("#file_content").html(content)}})}}})};console.log(document.cookie);var _user=null,_pwd=null,auth=null,repo=null,file=null,sha=null,content=null,_file_sha=null,api_ip=$("#serverIP").prop("value");function getCookie(b){b+="=";for(var a=decodeURIComponent(document.cookie).split(";"),e=0;e<a.length;e++){for(var c=a[e];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(b))return c.substring(b.length,c.length)}return""}
""!=getCookie("username")&&""!=getCookie("password")&&(_user=getCookie("username"),_pwd=getCookie("password"),$("#github_user").prop("value",_user),$("#github_pwd").prop("value",_pwd),auth=btoa(_user+":"+_pwd),$.get({url:"https://api.github.com/users/"+_user+"/repos",headers:{Authorization:"Basic "+auth},success:getRepos}));
function CSVToArray(b,a){a=a||",";for(var e=new RegExp("(\\"+a+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+a+"\\r\\n]*))","gi"),c=[[]],d;d=e.exec(b);){var f=d[1];f.length&&f!==a&&c.push([]);d=d[2]?d[2].replace(/""/g,'"'):d[3];c[c.length-1].push(d)}return c};var buttons=["#button_settings_login","#button_settings_save","#button_settings_models","#button_settings_about"],divs=["#settings_login","#settings_save","#settings_models","#settings_about"];$.each(buttons,function(b,a){$(a).click(function(){if(!$(this).hasClass("is-active")){$(this).addClass("is-active");for(j=0;j<buttons.length;j++)b!=j?$(buttons[j]).removeClass("is-active"):$(buttons[j]).addClass("is-active");$(divs[b]).show();for(j=0;j<divs.length;j++)b!=j&&$(divs[j]).hide()}})});
var modelsTabs=["#button_models_available","#button_models_loaded"],modelsMenus=["#modelslist","#modelsloaded"];$.each(modelsTabs,function(b,a){$(a).click(function(){if(!$(this).hasClass("is-active")){$(this).addClass("is-active");for(j=0;j<buttons.length;j++)b!=j?$(modelsTabs[j]).removeClass("is-active"):$(modelsTabs[j]).addClass("is-active");$(modelsMenus[b]).show();for(j=0;j<divs.length;j++)b!=j&&$(modelsMenus[j]).hide()}})});
function query_available_models(b){$.get({url:b+"list.csv",success:function(a){a=CSVToArray(a);for(var b=0;b<a.length-1;b++){var c=a[b][0].split(".")[0].trim(),d='<a id="'+c+'" class="model_button panel-block"><span class="panel-icon"><i class="fas fa-cube" aria-hidden="true"></i></span>';$("#modelslist").append(d+c+"</a>")}}})}query_available_models(api_ip);$("#login").click(onLogin);$("#github_repositories").change(function(){$("#github_files").html("");repo=$(this).prop("value");$("#github_files").html("");getFiles(repo)});$("#github_files").change(function(){file=$(this).prop("value");$("#github_version").html("");getFileVersions($(this).prop("value"))});$("#github_version").change(function(){sha=$("option:selected",this).attr("sha");$("#file_content").html("");getFileContent(file,sha);console.log(_file_sha)});
$("#button_save_modal").click(function(){$("#make_commit_field").show();$("#load_commit_field").hide();$("#button_load").hide();$("#button_save").show();$("#modal_title").html("Save reconstruction");$(".modal").addClass("is-active")});$("#button_load_modal").click(function(){$("#make_commit_field").hide();$("#load_commit_field").show();$("#button_save").hide();$("#button_load").show();$("#modal_title").html("Load reconstruction");$(".modal").addClass("is-active")});
$("#button_save").click(function(){$("#button_save").addClass("is-loading");$("#savemodal").addClass("is-active");sets={user:_user,pwd:_pwd,repo:repo,file:file,sha:_file_sha};var b=$("#commit_message").prop("value");b4w.require("numero_main").save_state(b,sets);getFileVersions(file)});$("#button_load").click(function(){$("#button_save").prop("disabled",!1);$("#button_delete").prop("disabled",!1);$(this).addClass("is-loading");sets={user:_user,pwd:_pwd,repo:repo,file:file,sha:_file_sha};b4w.require("numero_main").load_state(sets)});
$(".modal-close").click(function(){$(".modal").removeClass("is-active")});$(".delete").click(function(){$(".modal").removeClass("is-active")});$("#button_cancel").click(function(){$(".modal").removeClass("is-active")});$("#serverIP").change(function(){api_ip=$(this).prop("value");query_available_models(api_ip)});
