b4w.register("numero_main",function(z,f){function M(b,a){a?(E.create_preloader(),b.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1},b.addEventListener("mousedown",F),b.addEventListener("touchstart",F),b.addEventListener("mouseup",G),b.addEventListener("touchend",G),b.addEventListener("mousemove",H),b.addEventListener("touchmove",H),window.onresize=I.resize_to_container,I.resize_to_container(),N.load(O+"numero.json",P,Q)):console.log("b4w init failure")}function F(b){b.preventDefault&&
b.preventDefault();c=e.pick_object(b.offsetX,b.offsetY);if(2==b.button){if(null!=c){var a=e.get_object_name(c);if(b.ctrlKey)h.includes(c)?($("#"+a).find("input").prop("checked",!1),b=h.indexOf(c),-1!=b&&h.splice(b,1),e.set_outline_intensity(c,0)):($("#"+a).find("input").prop("checked",!0),h.push(c),e.set_outline_intensity(c,1));else{$("#"+a).siblings().find("input").prop("checked",!1);for(b=0;b<h.length;b++)e.set_outline_intensity(h[b],0);h.includes(c)?1<h.length?($("#"+a).find("input").prop("checked",
!0),h=[c],e.set_outline_intensity(c,1)):($("#"+a).find("input").prop("checked",!1),h=[]):($("#"+a).find("input").prop("checked",!0),h=[c],e.set_outline_intensity(c,1))}}}else null!=c&&h.includes(c)?0<h.length&&(w.disable_camera_controls(),a=e.get_active_camera(),b.ctrlKey?(A=!0,b=x.calc_ray(a,b.offsetX,b.offsetY,k),b=g.get_pline_directional_vec(b,u),a=p.get_translation(a,B),g.set_pline_initial_point(k,a),g.set_pline_directional_vec(k,b),a=g.line_plane_intersect(C,-1.1,k,r),r=p.get_translation(c),
q.subtract(a,r,y)):(v=!0,p.get_translation(c,u),x.project_point(a,u,t),t[0]=b.offsetX-t[0],t[1]=b.offsetY-t[1])):v=!1}function G(b){A=v=!1;w.enable_camera_controls();c=null}function H(b){if(v){var a=e.get_active_camera(),d=b.offsetX,n=b.offsetY;if(0<=d&&0<=n)for(d-=t[0],n-=t[1],d=x.calc_ray(a,d,n,k),d=g.get_pline_directional_vec(d,u),a=p.get_translation(a,B),g.set_pline_initial_point(k,a),g.set_pline_directional_vec(k,d),d=g.line_plane_intersect(C,-1.1,k,r),a=new Float32Array(3),q.subtract(d,p.get_translation(c),
a),d=0;d<h.length;d++)n=new Float32Array(3),q.add(p.get_translation(h[d]),a,n),p.set_translation_v(h[d],n)}A&&(a=e.get_active_camera(),d=x.calc_ray(a,b.offsetX,b.offsetY,k),d=g.get_pline_directional_vec(d,u),a=p.get_translation(a,B),g.set_pline_initial_point(k,a),g.set_pline_directional_vec(k,d),d=g.line_plane_intersect(C,-1.1,k,r),b=new Float32Array(3),r=p.get_translation(c),q.subtract(d,r,b),a=q.angle(b,y),d=new Float32Array(3),q.subtract(b,y,d),q.dot(d,[0,0,1]),n=new Float32Array(3),q.cross(d,
[0,0,1],n),p.rotate_z_local(c,Math.sign(n[0])*a),y=b)}function Q(b){E.update_preloader(b);$("#rideau").css("width",517-5.17*b);100==b&&($("#clickSomewhere").css("opacity",1),$("#loadingScreen").css("cursor","pointer"),$("#loadingScreen").click(function(){$(this).fadeOut(1E3)}))}function P(b,a){if(a){w.enable_camera_controls();var d=e.get_object_by_name("cube");e.hide_object(d);$(".model_button").click(function(){var a=$(this).attr("id"),b=$(this);$.get(api_ip+a+".json",function(n){e.get_all_objects("MESH");
var c=J.copy(d,a,!0),f=new Uint32Array(n.ibo);n=new Float32Array(n.vbo);K.override_geometry(c,"logo",f,n,!1);e.append_object(c);D.set_translation(c,0,0,1.1);e.show_object(c);e.update_scene_materials_params();b.remove();f='<label id="'+a+'" class="panel-block"><input type="checkbox">';$("#modelsloaded").append(f+a+"</input></label>");$("#"+a).find("input").bind("change",function(){var b=$(this).prop("checked");c=e.get_object_by_name(a);1==b?(h.push(c),e.set_outline_intensity(c,1)):(b=h.indexOf(c),
-1!=b&&h.splice(b,1),e.set_outline_intensity(c,0));console.log(h)})})})}else console.log("b4w load failure")}var w=f("app"),m=f("config"),N=f("data"),E=f("preloader"),R=f("version"),K=f("geometry"),e=f("scenes"),J=f("objects"),D=f("transform"),I=f("container");f("input");f("mouse");var p=f("transform"),x=f("camera"),g=f("math"),q=f("vec3");f("quat");var h=[],v=!1,A=!1,t=new Float32Array(2),k=g.create_pline(),u=new Float32Array(3),B=new Float32Array(3),r=new Float32Array(3),y=new Float32Array(3),C=
[0,0,1],c=null,L="DEBUG"==R.type(),O=m.get_assets_path("numero");z.init=function(){m.apply_quality(m.P_CUSTOM);m.set("enable_outlining",!0);m.set("shadows",!1);m.set("anisotropic_filtering",!1);m.set("antialiasing",!0);m.set("compositing",!1);m.set("motion_blur",!1);m.set("msaa_samples",1);w.init({canvas_container_id:"main_canvas_container",callback:M,console_verbose:L,autoresize:!0,show_fps:L})};z.save_state=function(b,a){var d=a.user,c=a.pwd,h=a.repo,f=a.file,g=a.sha,k="";a=e.get_all_objects("MESH");
for(var l=0;l<a.length;l++)if("cube"!=a[l].name&&"Plane"!=a[l].name){var m=p.get_matrix(a[l]);k+=a[l].name+","+m.toString()+"\n"}$.get("https://api.github.com/repos/"+d+"/"+h+"/contents/"+f,function(a){g=a.sha;a={path:f,message:b,content:btoa(k),sha:g};$.ajax({url:"https://api.github.com/repos/"+d+"/"+h+"/contents/"+f,data:JSON.stringify(a),contentType:"application/json",type:"PUT",beforeSend:function(a){a.setRequestHeader("Authorization","Basic "+btoa(d+":"+c))},success:function(a){$("#button_save").removeClass("is-loading");
$(".modal").removeClass("is-active")},error:function(a,b,d){console.log(" I did not did it:",a,b,d)}})})};z.load_state=function(b){$.ajax({url:"https://api.github.com/repos/"+b.user+"/"+b.repo+"/git/blobs/"+b.sha,success:function(a){var b=atob(a.content).split("\n"),c=[],f=[];for(a=0;a<b.length;a++){var g=b[a].split(",");if(2<g.length){c.push(g[0]);for(var k=new Float32Array(16),m=0;16>m;m++)k[m]=parseFloat(g[m+1]);f.push(k)}}g=e.get_all_objects("MESH");k=[];b=[];for(a=0;a<g.length;a++)"cube"==g[a].name||
"Plane"==g[a].name||c.includes(g[a].name)||k.push(g[a]),c.includes(g[a].name)&&b.push(g[a].name);for(a=0;a<k.length;a++)e.get_object_data_id(k[a]),e.remove_object(k[a]);g=e.get_all_objects("MESH");for(var l=0;l<c.length;l++)b.includes(c[l])?(a=e.get_object_by_name(c[l]),D.set_matrix(a,f[l])):$.ajax({url:api_ip+c[l]+".json",success:function(a){var b=e.get_object_by_name("cube");b=J.copy(b,c[l],!0);var d=new Uint32Array(a.ibo);a=new Float32Array(a.vbo);K.override_geometry(b,"logo",d,a,!0);e.append_object(b);
D.set_matrix(b,f[l]);e.show_object(b);e.update_scene_materials_params();$(".model_button").each(function(){$(this).attr("id")==c[l]&&$(this).remove()});a='<label id="'+c[l]+'" class="panel-block"><input type="checkbox">';$("#modelsloaded").append(a+c[l]+"</input></label>");$("#"+c[l]).find("input").bind("change",function(){var a=$(this).parent().attr("id");console.log(a);var b=$(this).prop("checked");a=e.get_object_by_name(a);1==b?(h.push(a),e.set_outline_intensity(a,1)):(b=h.indexOf(a),-1!=b&&h.splice(b,
1),e.set_outline_intensity(a,0));console.log(h)})},async:!1});$("#button_load").removeClass("is-loading");$(".modal").removeClass("is-active")}})}});b4w.require("numero_main").init();
