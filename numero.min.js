b4w.register("numero_main",function(y,e){function L(b,a){a?(D.create_preloader(),b.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1},b.addEventListener("mousedown",E),b.addEventListener("touchstart",E),b.addEventListener("mouseup",F),b.addEventListener("touchend",F),b.addEventListener("mousemove",G),b.addEventListener("touchmove",G),window.onresize=H.resize_to_container,H.resize_to_container(),M.load(N+"numero.json",O,P)):console.log("b4w init failure")}function E(b){b.preventDefault&&
b.preventDefault();c=f.pick_object(b.offsetX,b.offsetY);console.log(c);if(2==b.button){if(null!=c){var a=f.get_object_name(c);if(b.ctrlKey)h.includes(c)?($("#"+a).find("input").prop("checked",!1),b=h.indexOf(c),-1!=b&&h.splice(b,1),f.set_outline_intensity(c,0)):($("#"+a).find("input").prop("checked",!0),h.push(c),f.set_outline_intensity(c,1));else{$("#"+a).siblings().find("input").prop("checked",!1);for(b=0;b<h.length;b++)f.set_outline_intensity(h[b],0);h.includes(c)?1<h.length?($("#"+a).find("input").prop("checked",
!0),h=[c],f.set_outline_intensity(c,1)):($("#"+a).find("input").prop("checked",!1),h=[]):($("#"+a).find("input").prop("checked",!0),h=[c],f.set_outline_intensity(c,1))}}}else null!=c&&h.includes(c)?0<h.length&&(w.disable_camera_controls(),a=f.get_active_camera(),b.ctrlKey?(z=!0,b=x.calc_ray(a,b.offsetX,b.offsetY,k),b=g.get_pline_directional_vec(b,t),a=m.get_translation(a,A),g.set_pline_initial_point(k,a),g.set_pline_directional_vec(k,b),a=g.line_plane_intersect(B,-1.1,k,p),p=m.get_translation(c),
q.subtract(a,p,u),console.log(a,p,u)):(v=!0,m.get_translation(c,t),x.project_point(a,t,r),r[0]=b.offsetX-r[0],r[1]=b.offsetY-r[1])):v=!1}function F(b){z=v=!1;w.enable_camera_controls();c=null}function G(b){if(v){var a=f.get_active_camera(),d=b.offsetX,n=b.offsetY;if(0<=d&&0<=n)for(d-=r[0],n-=r[1],d=x.calc_ray(a,d,n,k),d=g.get_pline_directional_vec(d,t),a=m.get_translation(a,A),g.set_pline_initial_point(k,a),g.set_pline_directional_vec(k,d),d=g.line_plane_intersect(B,-1.1,k,p),a=new Float32Array(3),
q.subtract(d,m.get_translation(c),a),console.log(a),d=0;d<h.length;d++)n=new Float32Array(3),q.add(m.get_translation(h[d]),a,n),m.set_translation_v(h[d],n)}if(z){a=f.get_active_camera();d=x.calc_ray(a,b.offsetX,b.offsetY,k);d=g.get_pline_directional_vec(d,t);a=m.get_translation(a,A);g.set_pline_initial_point(k,a);g.set_pline_directional_vec(k,d);d=g.line_plane_intersect(B,-1.1,k,p);b=new Float32Array(3);p=m.get_translation(c);q.subtract(d,p,b);a=q.angle(b,u);d=new Float32Array(3);q.subtract(b,u,d);
n=q.dot(d,[0,0,1]);var e=new Float32Array(3);q.cross(d,[0,0,1],e);m.rotate_z_local(c,Math.sign(e[0])*a);u=b;console.log(a,n,e)}}function P(b){D.update_preloader(b)}function O(b,a){if(a){w.enable_camera_controls();var d=f.get_object_by_name("cube");f.hide_object(d);$(".model_button").click(function(){var a=$(this).attr("id"),b=$(this);$.get(api_ip+a+".json",function(n){f.get_all_objects("MESH");var c=I.copy(d,a,!0),e=new Uint32Array(n.ibo);n=new Float32Array(n.vbo);J.override_geometry(c,"logo",e,n,
!1);f.append_object(c);C.set_translation(c,0,0,1.1);f.show_object(c);f.update_scene_materials_params();b.remove();e='<label id="'+a+'" class="panel-block"><input type="checkbox">';$("#modelsloaded").append(e+a+"</input></label>");$("#"+a).find("input").bind("change",function(){var b=$(this).prop("checked");c=f.get_object_by_name(a);1==b?(h.push(c),f.set_outline_intensity(c,1)):(b=h.indexOf(c),-1!=b&&h.splice(b,1),f.set_outline_intensity(c,0));console.log(h)})})})}else console.log("b4w load failure")}
var w=e("app"),Q=e("config"),M=e("data"),D=e("preloader"),R=e("version"),J=e("geometry"),f=e("scenes"),I=e("objects"),C=e("transform"),H=e("container");e("input");e("mouse");var m=e("transform"),x=e("camera"),g=e("math"),q=e("vec3");e("quat");var h=[],v=!1,z=!1,r=new Float32Array(2),k=g.create_pline(),t=new Float32Array(3),A=new Float32Array(3),p=new Float32Array(3),u=new Float32Array(3),B=[0,0,1],c=null,K="DEBUG"==R.type(),N=Q.get_assets_path("numero");y.init=function(){w.init({canvas_container_id:"main_canvas_container",
callback:L,show_fps:K,console_verbose:K,autoresize:!0})};y.save_state=function(b,a){var d=a.user,c=a.pwd,e=a.repo,h=a.file,g=a.sha,k="";a=f.get_all_objects("MESH");for(var l=0;l<a.length;l++)if("cube"!=a[l].name&&"Plane"!=a[l].name){var p=m.get_matrix(a[l]);k+=a[l].name+","+p.toString()+"\n"}$.get("https://api.github.com/repos/"+d+"/"+e+"/contents/"+h,function(a){g=a.sha;a={path:h,message:b,content:btoa(k),sha:g};$.ajax({url:"https://api.github.com/repos/"+d+"/"+e+"/contents/"+h,data:JSON.stringify(a),
contentType:"application/json",type:"PUT",beforeSend:function(a){a.setRequestHeader("Authorization","Basic "+btoa(d+":"+c))},success:function(a){$("#button_save").removeClass("is-loading");$(".modal").removeClass("is-active")},error:function(a,b,d){console.log(" I did not did it:",a,b,d)}})})};y.load_state=function(b){$.ajax({url:"https://api.github.com/repos/"+b.user+"/"+b.repo+"/git/blobs/"+b.sha,success:function(a){var b=atob(a.content).split("\n"),c=[],e=[];for(a=0;a<b.length;a++){var g=b[a].split(",");
if(2<g.length){c.push(g[0]);for(var k=new Float32Array(16),m=0;16>m;m++)k[m]=parseFloat(g[m+1]);e.push(k)}}g=f.get_all_objects("MESH");k=[];b=[];for(a=0;a<g.length;a++)"cube"==g[a].name||"Plane"==g[a].name||c.includes(g[a].name)||k.push(g[a]),c.includes(g[a].name)&&b.push(g[a].name);for(a=0;a<k.length;a++)f.get_object_data_id(k[a]),f.remove_object(k[a]);g=f.get_all_objects("MESH");for(var l=0;l<c.length;l++)b.includes(c[l])?(a=f.get_object_by_name(c[l]),C.set_matrix(a,e[l])):$.ajax({url:api_ip+c[l]+
".json",success:function(a){var b=f.get_object_by_name("cube");b=I.copy(b,c[l],!0);var d=new Uint32Array(a.ibo);a=new Float32Array(a.vbo);J.override_geometry(b,"logo",d,a,!0);f.append_object(b);C.set_matrix(b,e[l]);f.show_object(b);f.update_scene_materials_params();$(".model_button").each(function(){$(this).attr("id")==c[l]&&$(this).remove()});a='<label id="'+c[l]+'" class="panel-block"><input type="checkbox">';$("#modelsloaded").append(a+c[l]+"</input></label>");$("#"+c[l]).find("input").bind("change",
function(){var a=$(this).parent().attr("id");console.log(a);var b=$(this).prop("checked");a=f.get_object_by_name(a);1==b?(h.push(a),f.set_outline_intensity(a,1)):(b=h.indexOf(a),-1!=b&&h.splice(b,1),f.set_outline_intensity(a,0));console.log(h)})},async:!1});$("#button_load").removeClass("is-loading");$(".modal").removeClass("is-active")}})}});b4w.require("numero_main").init();
