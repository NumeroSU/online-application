b4w.register("numero_main",function(C,g){function R(b,a){a?(H.create_preloader(),b.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1},b.addEventListener("mousedown",I),b.addEventListener("touchstart",I),b.addEventListener("mouseup",J),b.addEventListener("touchend",J),b.addEventListener("mousemove",K),b.addEventListener("touchmove",K),window.onresize=L.resize_to_container,L.resize_to_container(),S.load(T+"numero.json",U,V)):console.log("b4w init failure")}function I(b){b.preventDefault&&
b.preventDefault();d=e.pick_object(b.offsetX,b.offsetY);if(2==b.button){if(null!=d){var a=e.get_object_name(d);if(b.metaKey||b.ctrlKey)f.includes(d)?($("#"+a).find("input").prop("checked",!1),b=f.indexOf(d),-1!=b&&f.splice(b,1),e.set_outline_intensity(d,0)):($("#"+a).find("input").prop("checked",!0),f.push(d),e.set_outline_intensity(d,1));else{$("#"+a).siblings().find("input").prop("checked",!1);for(b=0;b<f.length;b++)e.set_outline_intensity(f[b],0);f.includes(d)?1<f.length?($("#"+a).find("input").prop("checked",
!0),f=[d],e.set_outline_intensity(d,1)):($("#"+a).find("input").prop("checked",!1),f=[]):($("#"+a).find("input").prop("checked",!0),f=[d],e.set_outline_intensity(d,1))}}}else if(null==d||!f.includes(d))z=!1;else if(0<f.length){A.disable_camera_controls();a=e.get_active_camera();var c=n.get_translation(a,x);if(b.metaKey||b.ctrlKey)D=!0,b=v.calc_ray(a,b.offsetX,b.offsetY,q),b=p.get_pline_directional_vec(b,w),c=n.get_translation(a,x),p.set_pline_initial_point(q,c),p.set_pline_directional_vec(q,b),a=
p.line_plane_intersect(E,-1.1,q,u),u=n.get_translation(d),l.subtract(a,u,B);else{if(0==b.button)z=!0;else if(1==b.button){F=!0;var t=c,g=[0,0,c[2]],h=n.get_translation(d);new Float32Array(3);var k=new Float32Array(3);l.subtract(g,t,k);l.normalize(k,k);g=new Float32Array(3);l.subtract(h,t,g);M=l.dot(g,k)/l.dot(k,k);t=new Float32Array(3);v.target_get_pivot(a,t);h=new Float32Array(3);l.subtract(c,t,h);h[2]=0;l.normalize(h,N)}n.get_translation(d,w);v.project_point(a,w,y);y[0]=b.offsetX-y[0];y[1]=b.offsetY-
y[1]}}}function J(b){D=F=z=!1;A.enable_camera_controls();d=null}function K(b){if(F){var a=e.get_active_camera(),c=b.offsetX;b=b.offsetY;if(0<=c&&0<=b)for(c=v.calc_ray(a,c,b,q),b=p.get_pline_directional_vec(c,w),c=new Float32Array(3),a=n.get_translation(a,x),p.set_pline_initial_point(q,a),p.set_pline_directional_vec(q,b),a[2]=0,p.line_plane_intersect(N,M-l.length(a),q,c),a=new Float32Array(3),l.subtract(c,n.get_translation(d),a),a[0]=0,c=a[1]=0;c<f.length;c++)b=new Float32Array(3),l.add(n.get_translation(f[c]),
a,b),n.set_translation_v(f[c],b)}else if(D){a=e.get_active_camera();c=v.calc_ray(a,b.offsetX,b.offsetY,q);b=p.get_pline_directional_vec(c,w);a=n.get_translation(a,x);p.set_pline_initial_point(q,a);p.set_pline_directional_vec(q,b);c=p.line_plane_intersect(E,-1.1,q,u);a=new Float32Array(3);u=n.get_translation(d);l.subtract(c,u,a);c=l.angle(a,B);b=new Float32Array(3);l.subtract(a,B,b);l.dot(b,[0,0,1]);var t=new Float32Array(3);l.cross(b,[0,0,1],t);n.rotate_z_local(d,Math.sign(t[0])*c);B=a}else if(z&&
(a=e.get_active_camera(),c=b.offsetX,b=b.offsetY,0<=c&&0<=b))for(c=v.calc_ray(a,c,b,q),b=p.get_pline_directional_vec(c,w),a=n.get_translation(a,x),p.set_pline_initial_point(q,a),p.set_pline_directional_vec(q,b),c=p.line_plane_intersect(E,-n.get_translation(d)[2],q,u),a=new Float32Array(3),l.subtract(c,n.get_translation(d),a),c=0;c<f.length;c++)b=new Float32Array(3),l.add(n.get_translation(f[c]),a,b),n.set_translation_v(f[c],b)}function V(b){H.update_preloader(b);$("#rideau").css("width",517-5.17*
b);100==b&&($("#clickSomewhere").css("opacity",1),$("#loadingScreen").css("cursor","pointer"),$("#loadingScreen").click(function(){$(this).fadeOut(1E3)}))}function U(b,a){if(a){A.enable_camera_controls();var c=e.get_object_by_name("cube");e.hide_object(c);$(".model_button").click(function(){var a=$(this).attr("id"),b=$(this);$.get(api_ip+a+".json",function(h){e.get_all_objects("MESH");var k=O.copy(c,a,!0),d=new Uint32Array(h.ibo);h=new Float32Array(h.vbo);P.override_geometry(k,"logo",d,h,!1);e.append_object(k);
G.set_translation(k,0,0,1.1);e.show_object(k);e.update_scene_materials_params();b.remove();d='<label id="'+a+'" class="panel-block"><input type="checkbox">';$("#modelsloaded").append(d+a+"</input></label>");$("#"+a).find("input").bind("change",function(){var b=$(this).prop("checked");k=e.get_object_by_name(a);1==b?(f.push(k),e.set_outline_intensity(k,1)):(b=f.indexOf(k),-1!=b&&f.splice(b,1),e.set_outline_intensity(k,0));console.log(f)})})})}else console.log("b4w load failure")}var A=g("app"),r=g("config"),
S=g("data"),H=g("preloader"),W=g("version"),P=g("geometry"),e=g("scenes"),O=g("objects"),G=g("transform"),L=g("container");g("input");g("mouse");var n=g("transform"),v=g("camera"),p=g("math"),l=g("vec3");g("quat");var f=[],z=!1,F=!1,D=!1,y=new Float32Array(2),q=p.create_pline(),w=new Float32Array(3),x=new Float32Array(3),u=new Float32Array(3),B=new Float32Array(3),E=[0,0,1],d=null,M=null,N=new Float32Array(3),Q="DEBUG"==W.type(),T=r.get_assets_path("numero");C.init=function(){r.apply_quality(r.P_CUSTOM);
r.set("enable_outlining",!0);r.set("shadows",!1);r.set("anisotropic_filtering",!1);r.set("antialiasing",!0);r.set("compositing",!1);r.set("motion_blur",!1);r.set("msaa_samples",1);A.init({canvas_container_id:"main_canvas_container",callback:R,console_verbose:Q,autoresize:!0,show_fps:Q})};C.save_state=function(b,a){var c=a.user,d=a.pwd,f=a.repo,h=a.file,k=a.sha,g="";a=e.get_all_objects("MESH");for(var m=0;m<a.length;m++)if("cube"!=a[m].name&&"Plane"!=a[m].name){var l=n.get_matrix(a[m]);g+=a[m].name+
","+l.toString()+"\n"}$.get("https://api.github.com/repos/"+c+"/"+f+"/contents/"+h,function(a){k=a.sha;a={path:h,message:b,content:btoa(g),sha:k};$.ajax({url:"https://api.github.com/repos/"+c+"/"+f+"/contents/"+h,data:JSON.stringify(a),contentType:"application/json",type:"PUT",beforeSend:function(a){a.setRequestHeader("Authorization","Basic "+btoa(c+":"+d))},success:function(a){$("#button_save").removeClass("is-loading");$(".modal").removeClass("is-active")},error:function(a,b,c){console.log(" I did not did it:",
a,b,c)}})})};C.load_state=function(b){$.ajax({url:"https://api.github.com/repos/"+b.user+"/"+b.repo+"/git/blobs/"+b.sha,success:function(a){var b=atob(a.content).split("\n"),d=[],g=[];for(a=0;a<b.length;a++){var h=b[a].split(",");if(2<h.length){d.push(h[0]);for(var k=new Float32Array(16),l=0;16>l;l++)k[l]=parseFloat(h[l+1]);g.push(k)}}h=e.get_all_objects("MESH");k=[];b=[];for(a=0;a<h.length;a++)"cube"==h[a].name||"Plane"==h[a].name||d.includes(h[a].name)||k.push(h[a]),d.includes(h[a].name)&&b.push(h[a].name);
for(a=0;a<k.length;a++)e.get_object_data_id(k[a]),e.remove_object(k[a]);h=e.get_all_objects("MESH");for(var m=0;m<d.length;m++)b.includes(d[m])?(a=e.get_object_by_name(d[m]),G.set_matrix(a,g[m])):$.ajax({url:api_ip+d[m]+".json",success:function(a){var b=e.get_object_by_name("cube");b=O.copy(b,d[m],!0);var c=new Uint32Array(a.ibo);a=new Float32Array(a.vbo);P.override_geometry(b,"logo",c,a,!0);e.append_object(b);G.set_matrix(b,g[m]);e.show_object(b);e.update_scene_materials_params();$(".model_button").each(function(){$(this).attr("id")==
d[m]&&$(this).remove()});a='<label id="'+d[m]+'" class="panel-block"><input type="checkbox">';$("#modelsloaded").append(a+d[m]+"</input></label>");$("#"+d[m]).find("input").bind("change",function(){var a=$(this).parent().attr("id");console.log(a);var b=$(this).prop("checked");a=e.get_object_by_name(a);1==b?(f.push(a),e.set_outline_intensity(a,1)):(b=f.indexOf(a),-1!=b&&f.splice(b,1),e.set_outline_intensity(a,0));console.log(f)})},async:!1});$("#button_load").removeClass("is-loading");$(".modal").removeClass("is-active")}})}});
b4w.require("numero_main").init();
