b4w.register("numero_main",function(w,g){function S(a,b){b?(G.create_preloader(),a.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1},a.addEventListener("mousedown",H),a.addEventListener("touchstart",H),a.addEventListener("mouseup",I),a.addEventListener("touchend",I),a.addEventListener("mousemove",J),a.addEventListener("touchmove",J),window.onresize=K.resize_to_container,K.resize_to_container(),T.load(U+"numero.json",V,W)):console.log("b4w init failure")}function H(a){a.preventDefault&&
a.preventDefault();h=f.pick_object(a.offsetX,a.offsetY);if(2==a.button){if(null!=h){var b=f.get_object_name(h);if(a.metaKey||a.ctrlKey)c.includes(h)?($("#"+b).find("input").prop("checked",!1),a=c.indexOf(h),-1!=a&&c.splice(a,1),f.set_outline_intensity(h,0)):($("#"+b).find("input").prop("checked",!0),c.push(h),f.set_outline_intensity(h,1));else{$("#"+b).siblings().find("input").prop("checked",!1);for(a=0;a<c.length;a++)f.set_outline_intensity(c[a],0);c.includes(h)?1<c.length?($("#"+b).find("input").prop("checked",
!0),c=[h],f.set_outline_intensity(h,1)):($("#"+b).find("input").prop("checked",!1),c=[]):($("#"+b).find("input").prop("checked",!0),c=[h],f.set_outline_intensity(h,1))}}}else if(null==h||!c.includes(h))x=!1;else if(0<c.length){y.disable_camera_controls();b=f.get_active_camera();var d=k.get_translation(b,z);if(a.metaKey||a.ctrlKey)B=!0,C=a.offsetX,a=r.calc_ray(b,a.offsetX,a.offsetY,n),a=l.get_pline_directional_vec(a,t),d=k.get_translation(b,z),l.set_pline_initial_point(n,d),l.set_pline_directional_vec(n,
a),b=l.line_plane_intersect(L,-1.1,n,A),A=k.get_translation(h),m.subtract(b,A,X);else{if(0==a.button)x=!0;else if(1==a.button){D=!0;var e=d,q=[0,0,d[2]],u=k.get_translation(h);new Float32Array(3);var g=new Float32Array(3);m.subtract(q,e,g);m.normalize(g,g);q=new Float32Array(3);m.subtract(u,e,q);M=m.dot(q,g)/m.dot(g,g);e=new Float32Array(3);r.target_get_pivot(b,e);u=new Float32Array(3);m.subtract(d,e,u);u[2]=0;m.normalize(u,N)}k.get_translation(h,t);r.project_point(b,t,v);v[0]=a.offsetX-v[0];v[1]=
a.offsetY-v[1]}}}function I(a){B=D=x=!1;y.enable_camera_controls();h=null}function J(a){if(D){var b=f.get_active_camera(),d=a.offsetX;a=a.offsetY;if(0<=d&&0<=a){d=r.calc_ray(b,d,a,n);a=l.get_pline_directional_vec(d,t);d=new Float32Array(3);b=k.get_translation(b,z);l.set_pline_initial_point(n,b);l.set_pline_directional_vec(n,a);b[2]=0;l.line_plane_intersect(N,M-m.length(b),n,d);var e=new Float32Array(3);m.subtract(d,k.get_translation(h),e);e[0]=0;for(b=e[1]=0;b<c.length;b++)a=new Float32Array(3),m.add(k.get_translation(c[b]),
e,a),k.set_translation_v(c[b],a)}}else if(B)if(d=.005*(a.offsetX-C),C=a.offsetX,1==c.length)k.rotate_z_local(h,d);else{e=new Float32Array(3);for(b=0;b<c.length;b++)a=k.get_translation(c[b]),m.add(e,a,e);m.scale(e,1/c.length,e);a=new Float32Array(3);for(b=0;b<c.length;b++)m.rotateZ(k.get_translation(c[b]),e,d,a),k.set_translation_v(c[b],a),k.rotate_z_local(c[b],d)}else if(x&&(b=f.get_active_camera(),d=a.offsetX,a=a.offsetY,0<=d&&0<=a))for(d=r.calc_ray(b,d,a,n),a=l.get_pline_directional_vec(d,t),b=
k.get_translation(b,z),l.set_pline_initial_point(n,b),l.set_pline_directional_vec(n,a),d=l.line_plane_intersect(L,-k.get_translation(h)[2],n,A),e=new Float32Array(3),m.subtract(d,k.get_translation(h),e),b=0;b<c.length;b++)a=new Float32Array(3),m.add(k.get_translation(c[b]),e,a),k.set_translation_v(c[b],a)}function W(a){G.update_preloader(a);$("#rideau").css("width",517-5.17*a);100==a&&($("#clickSomewhere").css("opacity",1),$("#loadingScreen").css("cursor","pointer"),$("#loadingScreen").click(function(){$(this).fadeOut(1E3)}))}
function E(a,b){b="undefined"!==typeof b?b:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,1.1,1];$.get(api_ip+a+".json",function(d){f.get_all_objects("MESH");var e=Y.copy(f.get_object_by_name("cube"),a,!0),q=new Uint32Array(d.ibo);d=new Float32Array(d.vbo);Z.override_geometry(e,"logo",q,d,!1);f.append_object(e);F.set_matrix(e,b);f.show_object(e);f.update_scene_materials_params();$("#"+a).remove();q='<label id="'+a+'" class="panel-block"><span class="panel-icon remove-model"><i class="fas fa-trash-alt" aria-hidden="true"></i></span><input type="checkbox">';
$("#modelsloaded").append(q+a+"</input></label>");$(".remove-model").click(function(b){b.preventDefault();$(this).parent().remove();b=$(this).parent().attr("id");var d=f.get_object_by_name(b);if(c.includes(d)){var e=c.indexOf(d);-1!=e&&c.splice(e,1)}f.remove_object(d);d='<a id="'+b+'" class="model_button panel-block"><span class="panel-icon"><i class="fas fa-cube" aria-hidden="true"></i></span>';$("#modelslist").append(d+b+"</a>");$("#"+a).click(O)});$("#"+a).find("input").bind("change",function(){var b=
$(this).prop("checked");e=f.get_object_by_name(a);1==b?(c.push(e),f.set_outline_intensity(e,1)):(b=c.indexOf(e),-1!=b&&c.splice(b,1),f.set_outline_intensity(e,0));console.log(c)})})}function O(){var a=$(this).attr("id");$(this).remove();E(a)}function P(a){for(var b=f.get_all_objects("MESH"),d=[],e=[],c=0;c<b.length;c++)"cube"==b[c].name||"Plane"==b[c].name||a.includes(b[c].name)||d.push(b[c]),a.includes(b[c].name)&&e.push(b[c].name);for(c=0;c<d.length;c++)f.remove_object(d[c]);return e}function Q(a){a=
atob(a).split("\n");var b=[],d=[];for(i=0;i<a.length;i++){var e=a[i].split(",");if(2<e.length){b.push(e[0]);for(var c=new Float32Array(16),f=0;16>f;f++)c[f]=parseFloat(e[f+1]);d.push(c)}}return{IDS:b,MATS:d}}function V(a,b){b?(y.enable_camera_controls(),f.hide_object(f.get_object_by_name("cube")),$(".model_button").click(O)):console.log("b4w load failure")}var y=g("app"),p=g("config"),T=g("data"),G=g("preloader"),aa=g("version"),Z=g("geometry"),f=g("scenes"),Y=g("objects"),F=g("transform"),K=g("container");
g("input");g("mouse");var k=g("transform"),r=g("camera"),l=g("math"),m=g("vec3");g("quat");var c=[],x=!1,D=!1,B=!1,v=new Float32Array(2),n=l.create_pline(),t=new Float32Array(3),z=new Float32Array(3),A=new Float32Array(3),X=new Float32Array(3),L=[0,0,1],h=null,M=null,N=new Float32Array(3),C=0,R="DEBUG"==aa.type(),U=p.get_assets_path("numero");w.init=function(){p.apply_quality(p.P_CUSTOM);p.set("enable_outlining",!0);p.set("shadows",!1);p.set("anisotropic_filtering",!1);p.set("antialiasing",!0);p.set("compositing",
!1);p.set("motion_blur",!1);p.set("msaa_samples",1);y.init({canvas_container_id:"main_canvas_container",callback:S,console_verbose:R,autoresize:!0,show_fps:R})};w.save_state=function(a,b){var d=b.user,e=b.pwd,c=b.repo,g=b.file,h=b.sha,m="";b=f.get_all_objects("MESH");for(var l=0;l<b.length;l++)if("cube"!=b[l].name&&"Plane"!=b[l].name){var n=k.get_matrix(b[l]);m+=b[l].name+","+n.toString()+"\n"}$.get("https://api.github.com/repos/"+d+"/"+c+"/contents/"+g,function(b){h=b.sha;b={path:g,message:a,content:btoa(m),
sha:h};$.ajax({url:"https://api.github.com/repos/"+d+"/"+c+"/contents/"+g,data:JSON.stringify(b),contentType:"application/json",type:"PUT",beforeSend:function(a){a.setRequestHeader("Authorization","Basic "+btoa(d+":"+e))},success:function(a){$("#button_save").removeClass("is-loading");$(".modal").removeClass("is-active")},error:function(a,b,d){console.log(" I did not did it:",a,b,d)}})})};w.load_state=function(a){$.ajax({url:"https://api.github.com/repos/"+a.user+"/"+a.repo+"/git/blobs/"+a.sha,success:function(a){a=
Q(a.content);for(var b=P(a.IDS),c=0;c<a.IDS.length;c++)if(b.includes(a.IDS[c])){var g=f.get_object_by_name(a.IDS[c]);F.set_matrix(g,a.MATS[c])}else E(a.IDS[c],a.MATS[c]);$("#button_load").removeClass("is-loading");$(".modal").removeClass("is-active")}})};w.load_default=function(){$.ajax({url:"https://api.github.com/repos/NumeroSU/temporary-saves/contents/tests.csv",success:function(a){a=Q(a.content);for(var b=P(a.IDS),c=0;c<a.IDS.length;c++)if(b.includes(a.IDS[c])){var e=f.get_object_by_name(a.IDS[c]);
F.set_matrix(e,a.MATS[c])}else E(a.IDS[c],a.MATS[c]);$("#button_load_default").removeClass("is-loading")}})}});b4w.require("numero_main").init();
