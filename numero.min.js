b4w.register("numero_main",function(z,c){function M(b,a){a?(E.create_preloader(),b.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1},b.addEventListener("mousedown",F),b.addEventListener("touchstart",F),b.addEventListener("mouseup",G),b.addEventListener("touchend",G),b.addEventListener("mousemove",H),b.addEventListener("touchmove",H),window.onresize=I.resize_to_container,I.resize_to_container(),N.load(O+"numero.json",P,Q)):console.log("b4w init failure")}function F(b){b.preventDefault&&
b.preventDefault();d=e.pick_object(b.offsetX,b.offsetY);console.log(d);if(2==b.button){if(null!=d){var a=e.get_object_name(d);if(b.ctrlKey)g.includes(d)?($("#"+a).find("input").prop("checked",!1),b=g.indexOf(d),-1!=b&&g.splice(b,1),e.set_outline_intensity(d,0)):($("#"+a).find("input").prop("checked",!0),g.push(d),e.set_outline_intensity(d,1));else{$("#"+a).siblings().find("input").prop("checked",!1);for(b=0;b<g.length;b++)e.set_outline_intensity(g[b],0);g.includes(d)?1<g.length?($("#"+a).find("input").prop("checked",
!0),g=[d],e.set_outline_intensity(d,1)):($("#"+a).find("input").prop("checked",!1),g=[]):($("#"+a).find("input").prop("checked",!0),g=[d],e.set_outline_intensity(d,1))}}}else null!=d&&g.includes(d)?0<g.length&&(x.disable_camera_controls(),a=e.get_active_camera(),b.ctrlKey?(A=!0,b=y.calc_ray(a,b.offsetX,b.offsetY,f),b=k.get_pline_directional_vec(b,u),a=m.get_translation(a,B),k.set_pline_initial_point(f,a),k.set_pline_directional_vec(f,b),a=k.line_plane_intersect(C,-1.1,f,n),n=m.get_translation(d),
q.subtract(a,n,v),console.log(a,n,v)):(w=!0,m.get_translation(d,u),y.project_point(a,u,r),r[0]=b.offsetX-r[0],r[1]=b.offsetY-r[1])):w=!1}function G(b){A=w=!1;x.enable_camera_controls();d=null}function H(b){if(w){var a=e.get_active_camera(),h=b.offsetX,p=b.offsetY;if(0<=h&&0<=p)for(h-=r[0],p-=r[1],h=y.calc_ray(a,h,p,f),h=k.get_pline_directional_vec(h,u),a=m.get_translation(a,B),k.set_pline_initial_point(f,a),k.set_pline_directional_vec(f,h),a=k.line_plane_intersect(C,-1.1,f,n),h=new Float32Array(3),
q.subtract(a,m.get_translation(d),h),console.log(h),i=0;i<g.length;i++)a=new Float32Array(3),q.add(m.get_translation(g[i]),h,a),m.set_translation_v(g[i],a)}if(A){a=e.get_active_camera();h=y.calc_ray(a,b.offsetX,b.offsetY,f);h=k.get_pline_directional_vec(h,u);a=m.get_translation(a,B);k.set_pline_initial_point(f,a);k.set_pline_directional_vec(f,h);a=k.line_plane_intersect(C,-1.1,f,n);b=new Float32Array(3);n=m.get_translation(d);q.subtract(a,n,b);a=q.angle(b,v);h=new Float32Array(3);q.subtract(b,v,h);
var p=q.dot(h,[0,0,1]),c=new Float32Array(3);q.cross(h,[0,0,1],c);m.rotate_z_local(d,Math.sign(c[0])*a);v=b;console.log(a,p,c)}}function Q(b){E.update_preloader(b)}function P(b,a){if(a){x.enable_camera_controls();var h=e.get_object_by_name("cube");e.hide_object(h);$(".model_button").click(function(){var a=$(this).attr("id"),b=$(this);$.get("https://"+api_ip+"/models/"+a,function(d){e.get_all_objects("MESH");var c=J.copy(h,a,!0),p=new Uint32Array(d.data.ibo);d=new Float32Array(d.data.vbo);K.override_geometry(c,
"logo",p,d,!1);e.append_object(c);D.set_translation(c,0,0,1.1);e.show_object(c);e.update_scene_materials_params();b.remove();p='<label id="'+a+'" class="panel-block"><input type="checkbox">';$("#modelsloaded").append(p+a+"</input></label>");$("#"+a).find("input").bind("change",function(){var b=$(this).prop("checked");c=e.get_object_by_name(a);1==b?(g.push(c),e.set_outline_intensity(c,1)):(b=g.indexOf(c),-1!=b&&g.splice(b,1),e.set_outline_intensity(c,0));console.log(g)})})})}else console.log("b4w load failure")}
var x=c("app"),R=c("config"),N=c("data"),E=c("preloader"),S=c("version"),K=c("geometry"),e=c("scenes"),J=c("objects"),D=c("transform"),I=c("container");c("input");c("mouse");var m=c("transform"),y=c("camera"),k=c("math"),q=c("vec3");c("quat");var g=[],w=!1,A=!1,r=new Float32Array(2),f=k.create_pline(),u=new Float32Array(3),B=new Float32Array(3),n=new Float32Array(3),v=new Float32Array(3),C=[0,0,1],d=null,L="DEBUG"==S.type(),O=R.get_assets_path("numero");z.init=function(){x.init({canvas_container_id:"main_canvas_container",
callback:M,show_fps:L,console_verbose:L,autoresize:!0})};z.save_state=function(b,a){for(var h=a.user,c=a.pwd,d=a.repo,g=a.file,k=a.sha,f="",l=e.get_all_objects("MESH"),t=0;t<l.length;t++)if("cube"!=l[t].name&&"Plane"!=l[t].name)var n=m.get_matrix(l[t]),f=f+(l[t].name+","+n.toString()+"\n");$.get("https://api.github.com/repos/"+h+"/"+d+"/contents/"+g,function(a){k=a.sha;a={path:g,message:b,content:btoa(f),sha:k};$.ajax({url:"https://api.github.com/repos/"+h+"/"+d+"/contents/"+g,data:JSON.stringify(a),
contentType:"application/json",type:"PUT",beforeSend:function(a){a.setRequestHeader("Authorization","Basic "+btoa(h+":"+c))},success:function(a){$("#button_save").removeClass("is-loading");$(".modal").removeClass("is-active")},error:function(a,b,c){console.log(" I did not did it:",a,b,c)}})})};z.load_state=function(b){$.ajax({url:"https://api.github.com/repos/"+b.user+"/"+b.repo+"/git/blobs/"+b.sha,success:function(a){var b=atob(a.content).split("\n"),c=[],d=[];for(a=0;a<b.length;a++){var f=b[a].split(",");
if(2<f.length){c.push(f[0]);for(var k=new Float32Array(16),m=0;16>m;m++)k[m]=parseFloat(f[m+1]);d.push(k)}}f=e.get_all_objects("MESH");k=[];b=[];for(a=0;a<f.length;a++)"cube"==f[a].name||"Plane"==f[a].name||c.includes(f[a].name)||k.push(f[a]),c.includes(f[a].name)&&b.push(f[a].name);for(a=0;a<k.length;a++)e.get_object_data_id(k[a]),e.remove_object(k[a]);for(var f=e.get_all_objects("MESH"),l=0;l<c.length;l++)b.includes(c[l])?(a=e.get_object_by_name(c[l]),D.set_matrix(a,d[l])):$.ajax({url:"https://"+
api_ip+"/models/"+c[l],success:function(a){var b=e.get_object_by_name("cube"),b=J.copy(b,c[l],!0),f=new Uint32Array(a.data.ibo);a=new Float32Array(a.data.vbo);K.override_geometry(b,"logo",f,a,!1);e.append_object(b);D.set_matrix(b,d[l]);e.show_object(b);e.update_scene_materials_params();$(".model_button").each(function(){$(this).attr("id")==c[l]&&$(this).remove()});a='<label id="'+c[l]+'" class="panel-block"><input type="checkbox">';$("#modelsloaded").append(a+c[l]+"</input></label>");$("#"+c[l]).find("input").bind("change",
function(){var a=$(this).parent().attr("id");console.log(a);var b=$(this).prop("checked"),a=e.get_object_by_name(a);1==b?(g.push(a),e.set_outline_intensity(a,1)):(b=g.indexOf(a),-1!=b&&g.splice(b,1),e.set_outline_intensity(a,0));console.log(g)})},async:!1});$("#button_load").removeClass("is-loading");$(".modal").removeClass("is-active")}})}});b4w.require("numero_main").init();
